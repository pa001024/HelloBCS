// 百度网页版转存后直链下载 v1.0.0 (minify)
var B={getMetaAsync:function(e){var t="/api/filemetas?blocks=1&dlink=1",n=Promise.defer();return $.post(t,{target:JSON.stringify([e])},function(e){e.errno?n.reject(e):n.resolve(e.info[0])}),n.promise},transferFileAsync:function(e,t,n,r){var a="/share/transfer",i=Promise.defer();return $.post(a+"?shareid="+e+"&from="+t,{filelist:JSON.stringify(["/"+n]),path:r},function(e){i.resolve(e)}),i.promise}};!function(){function e(e,t){r.obtain.useToast({toastMode:e?r.obtain.MODE_SUCCESS:r.obtain.MODE_FAILURE,msg:t,sticky:!0,position:4096,closeType:!0})}function t(t,n){var r=downFileButton||document.createElement("a");r.rel="noreferrer",r.download=t,r.href=n,e(1,"直链转化成功 点击下载按钮或右键复制链接到下载工具进行下载")}function n(){B.transferFileAsync(yunData.SHARE_ID,yunData.SHARE_UK,yunData.PATH,a).then(function(e){return B.getMetaAsync(a+"/"+yunData.FILENAME)},function(){e(0,"Σ(⊙▽⊙|||... 未知错误")}).then(function(e){t(e.server_filename,e.dlink)},function(){e(0,"Σ(⊙▽⊙|||... 未知错误")})}if("object"!=typeof yunData)return alert('Σ(⊙▽⊙"a...当前不是分享页面或者页面加载不正确\n请刷新页面再试哦');if(!yunData.MYUK)return alert("_(￣0￣)_~ 请登录后再进行操作");var r=require("common:widget/toast/toast.js");if(yunData.FILENAME){var a="/tmp";B.getMetaAsync("/tmp").then(n,function(t){-9==t.info[0].errno?B.createDirAsync("/tmp").then(n):e(0,"Σ(⊙▽⊙|||... 未知错误")})}else{var a=unescape(decodeURI(decodeURI(location.hash))).replace(/^(?:#path=\/?)?/,"/"),i=$(".item-active:first .name").attr("title");if(!i)return e(0,'~~ -______-" 请选中文件');if("dir"==$(".item-active:first").data("extname"))return e(0,"不支持文件夹");B.getMetaAsync(a+"/"+i).then(function(t){e(1,'直链转化成功 <a rel="noreferrer" download="'+i+'" href="'+t.dlink+'">点击下载</a>(或复制到下载工具)')},function(t){e(0,"直链转化失败 errno="+t.errno)})}}();